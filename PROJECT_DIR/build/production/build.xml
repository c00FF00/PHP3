<?xml version="1.0" encoding="UTF-8"?>

<project name="test.com" default="build" basedir=".">

    <target name="build" depends="setdomainname, copy, composer, symlink"/>

    <tstamp>
        <format property="TimeStamp" pattern="%Y-%m-%d-%H-%M-%S" locale="ru"/>
    </tstamp>

    <target name="vars">
        <property name="domain" value="test.com"/>
        <property name="configname" value="config.json"/>
        <property name="root.dir" value="/var/www/html/PHP3/htdocs"/>
        <resolvepath propertyName="target.dir" file="${root.dir}/${TimeStamp}"/>
    </target>

    <target name="setdomainname" depends="vars">
        <exec command="php genconf.php ${configname} ${domain}" dir="${project.basedir}" />
    </target>

    <target name="copy" depends="vars">
        <copy todir="${target.dir}">
            <fileset dir="${project.basedir}">
                <include name="**"/>
            </fileset>
        </copy>
    </target>

    <target name="composer" depends="vars">
        <exec command="composer install" dir="${target.dir}" checkreturn="true" passthru="true"/>
    </target>

    <target name="symlink" depends="vars">
        <symlink target="${target.dir}" link="${root.dir}/current" overwrite="true"/>
    </target>

</project>

